<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BioDSJobs - Data Science Jobs in Life Sciences</title>
  <style>
    :root {
      --primary-color: #3b82f6;
      --primary-hover: #2563eb;
      --secondary-color: #64748b;
      --success-color: #10b981;
      --border-color: #e2e8f0;
      --bg-light: #f8fafc;
      --bg-card: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0; 
      padding: 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: var(--text-primary);
    }
    
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 32px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0 0 8px 0;
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: -0.025em;
    }
    
    .header p {
      margin: 0;
      opacity: 0.9;
      font-size: 1.125rem;
    }
    
    .content {
      padding: 32px;
    }
    
    .stats {
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 32px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      text-align: center;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    
    .stat-icon {
      font-size: 2rem;
    }
    
    .stat-number {
      font-size: 1.875rem;
      font-weight: 700;
      color: var(--primary-color);
      line-height: 1;
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .filters {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-sm);
    }
    
    .filters-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .filters-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }
    
    .search-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 1rem;
      transition: border-color 0.2s, box-shadow 0.2s;
      background: var(--bg-card);
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgb(59 130 246 / 0.1);
    }
    
    .search-button {
      padding: 12px 24px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
    }
    
    .search-button:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }
    
    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .filter-group {
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 16px;
    }
    
    .filter-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .checkbox-group {
      max-height: 200px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--border-color) transparent;
    }
    
    .checkbox-group::-webkit-scrollbar {
      width: 6px;
    }
    
    .checkbox-group::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .checkbox-group::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 3px;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgb(226 232 240 / 0.5);
      transition: background-color 0.2s;
    }
    
    .checkbox-item:last-child {
      border-bottom: none;
    }
    
    .checkbox-item:hover {
      background: rgb(248 250 252 / 0.8);
      border-radius: var(--radius-sm);
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 16px;
      height: 16px;
      margin-right: 12px;
      accent-color: var(--primary-color);
      cursor: pointer;
    }
    
    .checkbox-item label {
      font-size: 0.875rem;
      cursor: pointer;
      color: var(--text-primary);
      flex: 1;
      font-weight: 500;
    }
    
    .selected-count {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 8px;
      padding: 4px 8px;
      background: var(--bg-card);
      border-radius: var(--radius-sm);
      text-align: center;
      font-weight: 500;
    }
    
    .time-select {
      padding: 10px 12px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      background: var(--bg-card);
      color: var(--text-primary);
      cursor: pointer;
      transition: border-color 0.2s;
    }
    
    .time-select:focus {
      outline: none;
      border-color: var(--primary-color);
    }
    
    .job {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 16px;
      transition: box-shadow 0.2s, transform 0.1s;
      box-shadow: var(--shadow-sm);
    }
    
    .job:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }
    
    .job h3 {
      margin: 0 0 12px 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.4;
    }
    
    .job-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .pill {
      font-size: 0.75rem;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 500;
      letter-spacing: 0.025em;
    }
    
    .pill-company {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .pill-location {
      background: var(--success-color);
      color: white;
    }
    
    .pill-source {
      background: var(--secondary-color);
      color: white;
    }
    
    .job-description {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 16px;
    }
    
    .job-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 600;
      font-size: 0.875rem;
      transition: color 0.2s;
    }
    
    .job-link:hover {
      color: var(--primary-hover);
    }
    
    .tip {
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 20px;
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
    }
    
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    
    .no-results h3 {
      margin: 0 0 8px 0;
      font-size: 1.125rem;
      font-weight: 600;
    }
    
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }
      
      .header {
        padding: 24px 20px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .content {
        padding: 20px;
      }
      
      .filter-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .stats {
        padding: 20px;
        gap: 16px;
      }
      
      .job {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>BioDSJobs</h1>
      <p>Data Science & Computational Biology Opportunities in Life Sciences</p>
    </div>
    
    <div class="content">
      <!-- Summary Statistics -->
      <div id="stats" class="stats">
        <div class="stat-item">
          <div class="stat-icon">üíº</div>
          <div class="stat-number" id="total-jobs">-</div>
          <div class="stat-label">Total Jobs</div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">üè¢</div>
          <div class="stat-number" id="total-companies">-</div>
          <div class="stat-label">Companies</div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">üîó</div>
          <div class="stat-number" id="total-sources">-</div>
          <div class="stat-label">Sources</div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">üïí</div>
          <div class="stat-number" id="last-updated">-</div>
          <div class="stat-label">Last Updated</div>
        </div>
      </div>
      
      <!-- Filters -->
      <div class="filters">
        <div class="filters-header">
          <div class="filters-title">üîç Search & Filter</div>
          <input id="q" type="search" class="search-input" placeholder="Search for specific terms (e.g., NGS, scRNA-seq, machine learning, genomics)" />
          <button class="search-button" onclick="loadJobs()">Search</button>
        </div>
        
        <div class="filter-grid">
          <div class="filter-group">
            <div class="filter-label">üè¢ Sources</div>
            <div class="checkbox-group" id="source-checkboxes">
              <div class="checkbox-item">
                <input type="checkbox" id="source-lever" value="lever">
                <label for="source-lever">Lever</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="source-greenhouse" value="greenhouse">
                <label for="source-greenhouse">Greenhouse</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="source-comprehensive" value="comprehensive">
                <label for="source-comprehensive">Comprehensive</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="source-talentbrew" value="talentbrew">
                <label for="source-talentbrew">TalentBrew</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="source-workday" value="workday">
                <label for="source-workday">Workday</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="source-ycombinator" value="ycombinator">
                <label for="source-ycombinator">Y Combinator</label>
              </div>
            </div>
            <div class="selected-count" id="source-count">All sources</div>
          </div>
          
          <div class="filter-group">
            <div class="filter-label">üìç Locations</div>
            <div class="checkbox-group" id="location-checkboxes">
              <div class="checkbox-item">
                <input type="checkbox" id="location-remote" value="remote">
                <label for="location-remote">üåç Remote</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="location-sf" value="san francisco bay area">
                <label for="location-sf">üåâ San Francisco Bay Area</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="location-boston" value="boston">
                <label for="location-boston">üèõÔ∏è Boston/Cambridge</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="location-nyc" value="new york">
                <label for="location-nyc">üóΩ New York City</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="location-seattle" value="seattle">
                <label for="location-seattle">üå≤ Seattle</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="location-la" value="los angeles">
                <label for="location-la">üå¥ Los Angeles</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="location-sd" value="san diego">
                <label for="location-sd">üèñÔ∏è San Diego</label>
              </div>
            </div>
            <div class="selected-count" id="location-count">All locations</div>
          </div>
          
          <div class="filter-group">
            <div class="filter-label">üíº Job Types</div>
            <div class="checkbox-group" id="jobtype-checkboxes">
              <div class="checkbox-item">
                <input type="checkbox" id="jobtype-research" value="research">
                <label for="jobtype-research">üî¨ Research</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="jobtype-engineering" value="engineering">
                <label for="jobtype-engineering">‚öôÔ∏è Engineering</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="jobtype-clinical" value="clinical">
                <label for="jobtype-clinical">üè• Clinical</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="jobtype-datascience" value="data science">
                <label for="jobtype-datascience">ÔøΩ Data Science</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="jobtype-management" value="management">
                <label for="jobtype-management">üë• Management</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="jobtype-operations" value="operations">
                <label for="jobtype-operations">üîß Operations</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="jobtype-sales" value="sales">
                <label for="jobtype-sales">ÔøΩ Sales & Marketing</label>
              </div>
            </div>
            <div class="selected-count" id="jobtype-count">All job types</div>
          </div>
          
          <div class="filter-group">
            <div class="filter-label">‚è∞ Time Range</div>
            <select id="days" class="time-select">
              <option value="">All time</option>
              <option value="1">Last 24 hours</option>
              <option value="7">Last 7 days</option>
              <option value="14">Last 14 days</option>
              <option value="30">Last 30 days</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="tip">
        üí° <strong>Search Tips:</strong> Use specific bioinformatics terms like "genomics", "RNA-seq", "computational biology", "machine learning", or "single-cell" for the most relevant results. Jobs are automatically ranked by relevance to data science and computational biology.
      </div>
      
      <div id="list"></div>
    </div>
  </div>

<script>
// Function to clean HTML content
function cleanHtmlText(html) {
  if (!html) return '';
  
  // Create a temporary div to parse HTML
  const temp = document.createElement('div');
  temp.innerHTML = html;
  
  // Get text content (removes HTML tags)
  let text = temp.textContent || temp.innerText || '';
  
  // Decode HTML entities
  const entityMap = {
    '&amp;': '&',
    '&lt;': '<',
    '&gt;': '>',
    '&quot;': '"',
    '&#39;': "'",
    '&nbsp;': ' ',
    '&hellip;': '‚Ä¶'
  };
  
  text = text.replace(/&[a-zA-Z0-9#]+;/g, (entity) => {
    return entityMap[entity] || entity;
  });
  
  // Clean up extra whitespace
  text = text.replace(/\s+/g, ' ').trim();
  
  return text;
}

// Function to get selected checkbox values
function getSelectedValues(groupId) {
  const checkboxes = document.querySelectorAll(`#${groupId} input[type="checkbox"]:checked`);
  return Array.from(checkboxes).map(cb => cb.value);
}

// Function to update selected count display
function updateSelectedCount(groupId, countId) {
  const selected = getSelectedValues(groupId);
  const countElement = document.getElementById(countId);
  
  if (selected.length === 0) {
    countElement.textContent = groupId.includes('source') ? 'All sources' : 
                              groupId.includes('location') ? 'All locations' : 'All job types';
  } else {
    countElement.textContent = `${selected.length} selected`;
  }
}

// Function to validate URL
function validateJobUrl(url, company) {
  if (!url || url === 'N/A' || url === '' || url === '#') {
    // Company-specific fallback URLs
    const companyFallbacks = {
      'benchling': 'https://www.benchling.com/careers',
      'ginkgo bioworks': 'https://www.ginkgobioworks.com/careers',
      'flagship pioneering': 'https://www.flagshippioneering.com/careers',
      'twist bioscience': 'https://www.twistbioscience.com/careers',
      '10x genomics': 'https://www.10xgenomics.com/careers',
      'grail': 'https://grail.com/careers',
      'color': 'https://www.color.com/careers'
    };
    
    const companyKey = company.toLowerCase().replace(/[^a-z0-9\s]/g, '').trim();
    return companyFallbacks[companyKey] || '#';
  }
  
  // Ensure URL has protocol
  if (!url.startsWith('http://') && !url.startsWith('https://')) {
    return 'https://' + url;
  }
  
  return url;
}

// Function to render a job
function renderJob(job) {
  const cleanTitle = cleanHtmlText(job.title);
  const cleanDescription = cleanHtmlText(job.description);
  const cleanCompany = cleanHtmlText(job.company);
  const cleanLocation = cleanHtmlText(job.location);
  const validUrl = validateJobUrl(job.url, cleanCompany);
  
  // Truncate description if too long
  const maxDescLength = 200;
  const shortDescription = cleanDescription.length > maxDescLength 
    ? cleanDescription.substring(0, maxDescLength) + '...' 
    : cleanDescription;

  // Format date
  const date = new Date(job.posted_at);
  const now = new Date();
  const daysAgo = Math.floor((now - date) / (1000 * 60 * 60 * 24));
  const timeAgo = daysAgo === 0 ? 'Today' : 
                  daysAgo === 1 ? '1 day ago' : 
                  daysAgo < 7 ? `${daysAgo} days ago` : 
                  date.toLocaleDateString();

  return `
    <div class="job">
      <h3>${cleanTitle}</h3>
      <div class="job-meta">
        <span class="pill pill-company">${cleanCompany}</span>
        <span class="pill pill-location">üìç ${cleanLocation}</span>
        <span class="pill pill-source">üîó ${job.source}</span>
        <span class="pill" style="background: #f1f5f9; color: #64748b;">‚è∞ ${timeAgo}</span>
      </div>
      <div class="job-description">${shortDescription}</div>
      <a href="${validUrl}" target="_blank" rel="noopener noreferrer" class="job-link">
        View Job Details ‚Üí
      </a>
    </div>
  `;
}

// Function to apply client-side job type filtering
function applyJobTypeFilter(jobs, selectedJobTypes) {
  if (selectedJobTypes.length === 0) return jobs;
  
  const jobTypePatterns = {
    'research': /research|scientist|postdoc|phd|investigator|fellow/i,
    'engineering': /engineer|developer|software|platform|infrastructure|backend|frontend|devops|architect/i,
    'clinical': /clinical|medical|physician|doctor|nurse|regulatory|compliance|trial|study/i,
    'data science': /data.scientist|machine.learning|ml|ai|artificial.intelligence|analytics|statistician|bioinformatics|computational/i,
    'management': /manager|director|lead|head|chief|vp|vice.president|executive|supervisor|coordinator/i,
    'operations': /operations|ops|analyst|specialist|coordinator|administrator|support|quality|manufacturing/i,
    'sales': /sales|marketing|business.development|account|customer|client|commercial|market/i
  };
  
  return jobs.filter(job => {
    const jobText = `${job.title} ${job.description}`.toLowerCase();
    return selectedJobTypes.some(type => {
      const pattern = jobTypePatterns[type];
      return pattern && pattern.test(jobText);
    });
  });
}

// Load statistics
async function loadStats() {
  try {
    const response = await fetch('http://localhost:8000/api/stats');
    const stats = await response.json();
    
    document.getElementById('total-jobs').textContent = stats.total_jobs?.toLocaleString() || '0';
    document.getElementById('total-companies').textContent = stats.total_companies?.toLocaleString() || '0';
    document.getElementById('total-sources').textContent = stats.total_sources?.toLocaleString() || '0';
    
    if (stats.latest_job_date) {
      const date = new Date(stats.latest_job_date);
      document.getElementById('last-updated').textContent = date.toLocaleDateString();
    } else {
      document.getElementById('last-updated').textContent = 'Unknown';
    }
  } catch (error) {
    console.error('Error loading stats:', error);
    document.getElementById('total-jobs').textContent = 'Error';
    document.getElementById('total-companies').textContent = 'Error';
    document.getElementById('total-sources').textContent = 'Error';
    document.getElementById('last-updated').textContent = 'Error';
  }
}

// Load jobs
async function loadJobs() {
  const listEl = document.getElementById('list');
  listEl.innerHTML = '<div class="loading">üîÑ Loading jobs...</div>';
  
  try {
    // Build query parameters
    const params = new URLSearchParams();
    
    const query = document.getElementById('q').value.trim();
    if (query) params.append('q', query);
    
    const selectedSources = getSelectedValues('source-checkboxes');
    selectedSources.forEach(source => params.append('source', source));
    
    const selectedLocations = getSelectedValues('location-checkboxes');
    selectedLocations.forEach(location => params.append('location', location));
    
    const days = document.getElementById('days').value;
    if (days) params.append('days', days);
    
    // Set a higher limit to get more jobs for client-side filtering
    params.append('limit', '200');
    
    const response = await fetch(`http://localhost:8000/api/jobs?${params.toString()}`);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    let jobs = await response.json();
    
    // Apply client-side job type filtering
    const selectedJobTypes = getSelectedValues('jobtype-checkboxes');
    jobs = applyJobTypeFilter(jobs, selectedJobTypes);
    
    if (jobs.length === 0) {
      listEl.innerHTML = `
        <div class="no-results">
          <h3>No jobs found</h3>
          <p>Try adjusting your search terms or filters to find more opportunities.</p>
        </div>
      `;
      return;
    }
    
    listEl.innerHTML = jobs.map(renderJob).join('');
    
  } catch (error) {
    console.error('Error loading jobs:', error);
    listEl.innerHTML = `
      <div class="no-results">
        <h3>Error loading jobs</h3>
        <p>Please try again later or contact support if the problem persists.</p>
      </div>
    `;
  }
}

// Add event listeners for filter updates
document.addEventListener('DOMContentLoaded', function() {
  // Load initial data
  loadStats();
  loadJobs();
  
  // Add event listeners for checkbox changes
  ['source-checkboxes', 'location-checkboxes', 'jobtype-checkboxes'].forEach(groupId => {
    const group = document.getElementById(groupId);
    if (group) {
      group.addEventListener('change', function() {
        const countId = groupId.replace('-checkboxes', '-count');
        updateSelectedCount(groupId, countId);
        loadJobs(); // Auto-reload when filters change
      });
    }
  });
  
  // Add event listener for days filter
  document.getElementById('days').addEventListener('change', loadJobs);
  
  // Add event listener for search input (debounced)
  let searchTimeout;
  document.getElementById('q').addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(loadJobs, 500); // Wait 500ms after user stops typing
  });
  
  // Enter key in search field
  document.getElementById('q').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      loadJobs();
    }
  });
});
</script>
</body>
</html>
